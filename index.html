<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Whiteboard</title>
    <link rel="icon" href="images/whiteboard-logo.png">
    <!-- Device Icons -->
    <link rel="apple-touch-icon" sizes="90x90" href="images/90.png">
    <link rel="apple-touch-icon" sizes="152x152" href="images/152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="images/167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/180.png">
    <!-- Style -->
    <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <div id="container">
      <div id="vue">
        <canvas id="draw"></canvas>

        <div class="logo">
          <img src="images/whiteboard-logo.png" alt=""></img>
        </div>

        <nav>
          <a>
            <img class="color" src="images/color.svg" alt=""></img>
            <input onchange="updateColor()" id="color" type="color" value="#25A3FF"></input>
          </a>
          <div id="radius" onclick="toggleSizes()">
            <div id="radiusSize" class="size" v-bind:style="{height: value + 'px', width: value + 'px'}"></div>
            <div class="radius-sizes toggle">
              <input onchange="updateSize()" id="size" type="range" min="1" max="20" value="4" v-model="value"></input>
            </div>
          </div>
          <div class="spacer"></div>
          <a id="download" download="whiteboard.png" href="" onclick="downloadCanvas(this);">
            <img src="images/save@2x.png" alt="">
          </a>
          <a onclick="clearCanvas()">
            <img src="images/trash@2x.png" alt="">
          </a>
        </nav>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.2.1/vue.min.js"></script>

    <script>
      var app = new Vue({
        el: '#vue',
        data: {
          value: 4
        }
      });

      var canvas = document.getElementById('draw');
      var ctx = canvas.getContext('2d');

      canvas.width = 2200;
      canvas.height = 1600;

      ctx.lineJoin = 'round';
      ctx.lineCap = 'round';
      ctx.lineWidth = 4;
      ctx.strokeStyle = '#25A3FF';

      let isDrawing = false;
      let lastX = 0;
      let lastY = 0;

      function draw(e) {
        // stop the function if they are not mouse down
        if (!isDrawing) return;
        //listen for mouse move event
        console.log(e);
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
        [lastX, lastY] = [e.offsetX, e.offsetY];
      };

      canvas.addEventListener('mousedown', (e) => {
        isDrawing = true;
        [lastX, lastY] = [e.offsetX, e.offsetY];
      });

      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', () => isDrawing = false);
      canvas.addEventListener('mouseout', () => isDrawing = false);

      function clearCanvas() {
        console.log('cleared');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      };

      function toggleSizes() {
        document.getElementsByClassName('radius-sizes')[0].classList.toggle('toggle');
      };

      function updateSize() {
        var radiusValue = document.getElementById('size').value;
        ctx.lineWidth = radiusValue;
        document.getElementById('radiusSize').style.width = radiusValue;
        document.getElementById('radiusSize').style.height = radiusValue;
      };

      function updateColor() {
        var colorValue = document.getElementById('color').value;
        ctx.strokeStyle = colorValue;
      };

      downloadCanvas = function(el) {
        var image = canvas.toDataURL("image/png");
        el.href = image;
      };
    </script>
  </body>

</html>